function Envi(t,i,s){this.canvas=new Canvas(t),this.keyboard=new Keyboard(i),this.width=this.canvas.width,this.height=this.canvas.height,this.depth=(this.canvas.width+this.canvas.height)/1.5,this.shiftX=1,this.shiftY=1,this.font="sans-serif",this.fontMax=15,this.fontStyle="",this.frame=[this.width,this.height,this.depth],this.printStyle="fill",this.resolutionFactor=16,this.shapes=new Shapes,this.models=new Models}function Scene(t,i){void 0===i&&(i=[]),this.envi=t,this.assets=i}Envi.prototype.pointTo3D=function(t){var i=t[0]+t[2]/this.depth*(this.width*this.shiftX/2-t[0]),s=t[1]+t[2]/this.depth*(this.height*this.shiftY/2-t[1]);return[i,s]},Envi.prototype.doModelAnimation=function(t,i){for(var s=0;s<i.modelAttributes.length;s+=1)t=i.modelAttributes[s].processPoint(this.frame,t,i);return t},Envi.prototype.charToSize=function(t){if(t<this.depth){var i=this.fontMax*((this.depth-t)/this.depth),s=Math.round(i).toString()+"px ";return[this.fontStyle+s+this.font]}return[this.fontStyle+"0px"+this.font]},Scene.prototype.add=function(t){typeof t===Array?this.assets=this.assets+t:this.assets[this.assets.length]=t},Scene.prototype.play=function(){this.envi.keyCheck(),this.envi.mouseCheck(),this.envi.canvas.ctx.clearRect(0,0,this.envi.width,this.envi.height);for(var t=0;t<this.assets.length;t+=1)this.assets[t].draw(this.envi)};
function Frame(t,s,i){this.width=width,this.height=s,this.depth=i}function explode_infinite(t,s,i,e,h){void 0===e&&(e=1),void 0===h&&(h=0),this.side=t,this.distance=s,this.scale=i,this.speed=e/100}function rotateY(t,s){void 0===s&&(s=1),this.side=t,this.speed=s,this.state=0}function moveTo(t,s,i,e){this.x=t,this.y=s,this.z=i,this.speed=e,this.state=1,this.dist=60,this.firstTime=!0,this.sign=function(t){return t>0?1:0>t?-1:0}}function planeXTransform(t,s,i,e){void 0===i&&(i=1),void 0===e&&(e=0),this.distance=t,this.scale=s,this.speed=i,this.state=e}function planeWave(t,s,i){this.state=1,this.speed=t,this.width=s,this.depth=i}function house_fly(t,s,i){void 0===i&&(i=!1),this.speed=t,this.range=s,this.slave=i,this.direction=[1,1,1]}explode_infinite.prototype.processPoint=function(t,s,i){for(var e=0;e<s.length-1;e+=1)s[e]>this.side*i.scale/2?s[e]=s[e]+this.scale*this.state:s[e]==this.side*i.scale/2||(s[e]=s[e]-this.scale*this.state);return 1e7>this.state?this.state+=1*this.speed:this.state=0,s},rotateY.prototype.processPoint=function(t,s,i){var e=this.side/2*i.scale,h=(this.half-s[0])/e,o=(this.half-s[2])/e,n=h*this.side*(this.state/1e3);s[0]=s[0]*n;var a=o*this.side*(this.state/1e3);return s[2]=s[0]*a,this.state<1e3?this.state+=1*this.speed:(console.log("half: "+e),console.log("point[0]; "+s[0]),console.log("deltaX: "+h),console.log("rotX: "+n),this.state=0),s},moveTo.prototype.processPoint=function(t){return this.firstTime&&(this.dx=this.x-t.pos[0],this.dy=this.y-t.pos[1],this.dz=this.z-t.pos[2],this.length=this.dist/this.speed,this.firstTime=!1),t.pos[0]+=this.dx/this.dist*this.speed,t.pos[1]+=this.dx/this.dist*this.speed,t.pos[2]+=this.dz/this.dist*this.speed,this.state++,this.state>this.length?0:1},planeWave.prototype.processPoint=function(t,s,i){return s[0]==this.state?s[2]=s[2]+this.depth:(s[1]==this.state||s[-1]==this.state)&&(s[2]=s[2]+this.depth/2),i.width>this.state?this.state+=1*this.speed:this.state=1,s},planeWave.prototype.processGeo=function(t){for(var s=this.state/t.scale,i=[],e=0;e<t.geo.length;e+=1){var h=t.geo[e];h[0]==s?h[2]=h[2]+this.depth:(h[1]==s||h[-1]==s)&&(h[2]=h[2]+this.depth/2),i[i.length]=[h]}return t.width>s?this.state+=1*this.speed:this.state=1,i},house_fly.prototype.processPoint=function(t,s){if(0==this.slave)for(var i=0;i<t.pos.length;i+=1){var e=Math.abs(s[i]/2-t.pos[i]);e<s[i]/2*Math.max(.4,Math.random())?t.pos[i]=t.pos[i]+Math.random()*this.speed*this.direction[i]:this.direction[i]=-1*this.direction[i]}};
function Asset(t,s,o,i,e){void 0===t&&(t=[]),void 0===s&&(s=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===e&&(e=1),this.geo=t,this.xpos=s,this.ypos=o,this.zpos=i,this.pos=[this.xpos,this.ypos,this.zpos],this.scale=e,this.modelAttributes=[],this.sceneAttributes=[],this.transforms=[],this.width=void 0,this.height=void 0}Asset.prototype.draw=function(t){this.doSceneAnimation(t.frame),this.doTranforms();var s=[];for(i=0;i<this.geo.length;i+=1){s=this.setModelScale(this.geo[i]),s=t.doModelAnimation(s,this),s=this.moveToScenePos(s);var o=t.pointTo3D(s),e=[s[3],t.charToSize(s[2])];t.canvas.ctx.font=e[1],t.canvas.ctx.fillStyle=this.geo[i][4],t.canvas.ctx.fillText(e[0],o[0],o[1])}},Asset.prototype.setModelScale=function(t){return[t[0]*this.scale,t[1]*this.scale,t[2]*this.scale,t[3]]},Asset.prototype.moveToScenePos=function(t){return[this.pos[0]+t[0],this.pos[1]+t[1],this.pos[2]+t[2],t[3],t[4]]},Asset.prototype.doSceneAnimation=function(t){for(var s=0;s<this.sceneAttributes.length;s+=1)this.sceneAttributes[s].processPoint(this,t)},Asset.prototype.transform=function(t){this.transforms.push(t)},Asset.prototype.doTranforms=function(){for(var t=0;t<this.transforms.length;t+=1){var s=this.transforms[t].processPoint(this);s||this.transforms.splice(t,1)}};
function ImageGrid(t,i){this.envi=t,this.img=null,this.grid={},this.sourceFile=i,this.data=this.makeData(),this.geo=this.makeGeo(),this.asset}ImageGrid.prototype.toAsset=function(t,e,s,h){this.xpos=t,this.ypos=e,this.zpos=s,this.pos=[t,e,s],this.scale=h,this.modelAttributes=[],this.sceneAttributes=[],this.width=this.img.width,this.height=this.img.height;var o,n;for(i=0;i<this.geo.length;i+=1)o=this.geo[i],n=[o[0]*this.scale,o[1]*this.scale,o[2]*this.scale,o[3]],n=[this.xpos+n[0],this.ypos+n[1],this.zpos+n[2],o[3],o[4]],this.geo[i]=n;this.draw=function(){for(var t=[],e=0;e<this.modelAttributes.length;e+=1)t=this.modelAttributes[e].processGeo(this);for(i=0;i<t.length;i+=1){var s=t[i],h=this.envi.pointTo3D(s),o=[s[3],this.envi.charToSize(s[2])];this.envi.canvas.ctx.font=o[1],this.envi.canvas.ctx.fillStyle=s[4],this.envi.canvas.ctx.fillText(o[0],h[0],h[1])}}},ImageGrid.prototype.makeData=function(){this.img=new Image,this.img.src=this.sourceFile,this.grid.width=this.img.width/this.envi.resolutionFactor,this.grid.height=this.img.height/this.envi.resolutionFactor,envi.dummyContext.width=this.img.width,envi.dummyContext.height=this.img.height,envi.dummyContext.drawImage(this.img,0,0);for(var t=[],i=1;i<this.grid.width;i+=1)for(var e=1;e<this.grid.height;e+=1)t[i*e]=envi.dummyContext.getImageData(i*this.envi.resolutionFactor,e*this.envi.resolutionFactor,1,1).data;return t},ImageGrid.prototype.makeGeo=function(t){"undefined"==typeof t&&(t="o");for(var i=[],e=1;e<this.grid.width;e+=1)for(var s=1;s<this.grid.height;s+=1)i[i.length]=[e,s,1,t,this.rgbToHex(this.data[e*s])];return i},ImageGrid.prototype.rgbToHex=function(t){return"#"+this.componentToHex(t[0])+this.componentToHex(t[1])+this.componentToHex(t[2])},ImageGrid.prototype.componentToHex=function(t){var i=t.toString(16);return 1==i.length?"0"+i:i};
function Models(){this.box=[[0,0,0,"0"],[5,0,0,"0"],[5,5,0,"0"],[0,5,0,"0"],[0,0,5,"0"],[5,0,5,"0"],[5,5,5,"0"],[0,5,5,"0"]],this.diamond=[[5,0,5,"#"],[0,5,5,"#"],[10,5,5,"#"],[5,10,5,"#"],[5,5,0,"#"],[5,5,10,"#"],[4,1,5,"."],[3,2,5,"."],[2,3,5,"."],[1,4,5,"."],[6,1,5,"."],[7,2,5,"."],[8,3,5,"."],[9,4,5,"."],[4,9,5,"."],[3,8,5,"."],[2,7,5,"."],[1,6,5,"."],[6,9,5,"."],[7,8,5,"."],[8,7,5,"."],[9,6,5,"."],[5,1,4,"."],[5,2,3,"."],[5,3,2,"."],[5,4,1,"."],[5,1,6,"."],[5,2,7,"."],[5,3,8,"."],[5,4,9,"."],[5,9,4,"."],[5,8,3,"."],[5,7,2,"."],[5,6,1,"."],[5,9,6,"."],[5,8,7,"."],[5,7,8,"."],[5,6,9,"."],[4,5,1,"."],[3,5,2,"."],[2,5,3,"."],[1,5,4,"."],[6,5,1,"."],[7,5,2,"."],[8,5,3,"."],[9,5,4,"."],[4,5,9,"."],[3,5,8,"."],[2,5,7,"."],[1,5,6,"."],[6,5,9,"."],[7,5,8,"."],[8,5,7,"."],[9,5,6,"."]],this.palmTree=[[5,10,5,"i"],[5,9,5,"i"],[5,8,5,"i"],[5,7,5,"i"],[5,6,5,"i"],[5,6,5,"i"],[5,5,5,"i"],[5,4,5,"i"],[5,3,5,"i"],[5,2,5,"i"],[5,1,5,"*"],[4,1,4,"*"],[3,1,3,"*"],[2,2,2,"*"],[1,3,1,"*"],[6,1,4,"*"],[7,1,3,"*"],[8,2,2,"*"],[9,3,1,"*"],[6,1,6,"*"],[7,1,7,"*"],[8,2,8,"*"],[9,3,9,"*"],[4,1,6,"*"],[3,1,7,"*"],[2,2,8,"*"],[1,3,9,"*"]],this.sun=[[5,0,5,"#","#FFCC00"],[0,5,5,"#","#FFCC00"],[10,5,5,"#","#FFCC00"],[5,10,5,"#","#FFCC00"],[5,5,0,"#","#FFCC00"],[5,5,10,"#","#FFCC00"],[4,1,5,"-","#FFCC00"],[3,2,5,"-","#FFCC00"],[2,3,5,"-","#FFCC00"],[1,4,5,"-","#FFCC00"],[6,1,5,"-","#FFCC00"],[7,2,5,"-","#FFCC00"],[8,3,5,"-","#FFCC00"],[9,4,5,"-","#FFCC00"],[4,9,5,"-","#FFCC00"],[3,8,5,"-","#FFCC00"],[2,7,5,"-","#FFCC00"],[1,6,5,"-","#FFCC00"],[6,9,5,"-","#FFCC00"],[7,8,5,"-","#FFCC00"],[8,7,5,"-","#FFCC00"],[9,6,5,"-","#FFCC00"],[5,1,4,"-","#FFCC00"],[5,2,3,"-","#FFCC00"],[5,3,2,"-","#FFCC00"],[5,4,1,"-","#FFCC00"],[5,1,6,"-","#FFCC00"],[5,2,7,"-","#FFCC00"],[5,3,8,"-","#FFCC00"],[5,4,9,"-","#FFCC00"],[5,9,4,"-","#FFCC00"],[5,8,3,"-","#FFCC00"],[5,7,2,"-","#FFCC00"],[5,6,1,"-","#FFCC00"],[5,9,6,"-","#FFCC00"],[5,8,7,"-","#FFCC00"],[5,7,8,"-","#FFCC00"],[5,6,9,"-","#FFCC00"],[4,5,1,"-","#FFCC00"],[3,5,2,"-","#FFCC00"],[2,5,3,"-","#FFCC00"],[1,5,4,"-","#FFCC00"],[6,5,1,"-","#FFCC00"],[7,5,2,"-","#FFCC00"],[8,5,3,"-","#FFCC00"],[9,5,4,"-","#FFCC00"],[4,5,9,"-","#FFCC00"],[3,5,8,"-","#FFCC00"],[2,5,7,"-","#FFCC00"],[1,5,6,"-","#FFCC00"],[6,5,9,"-","#FFCC00"],[7,5,8,"-","#FFCC00"],[8,5,7,"-","#FFCC00"],[9,5,6,"-","#FFCC00"],[3,5,3,"-","#FFCC00"],[3,5,8,"-","#FFCC00"],[8,5,3,"-","#FFCC00"],[8,5,8,"-","#FFCC00"]],this.grass=[[5,4,0,". .  .    .","#663300"],[0,3,0,")","#003300"],[4,3,0,"(","#003300"],[0,3,0,"(","#003300"],[3,3,2,")","#003300"]],this.fly=[[2,2,2,"."],[1,2,2,"-"],[3,2,2,"-"]],this.planet=[[0,0,0,".","#ffffff"]],this.planetB=[[0,0,0,".","#FFCC00"]],this.planetC=[[0,0,0,".","#46E3AC"]]}
function Shapes(){}Shapes.prototype.cube=function(o,r,p){void 0===r&&(r="."),void 0===p&&(p="#000");for(var t=[],h=0;o>h;h++)t.push([0,h,0,r,p]),t.push([o,h,0,r,p]),t.push([h,0,0,r,p]),t.push([h,o,0,r,p]),t.push([0,h,o,r,p]),t.push([o,h,o,r,p]),t.push([h,0,o,r,p]),t.push([h,o,o,r,p]),t.push([0,0,h,r,p]),t.push([0,o,h,r,p]),t.push([o,0,h,r,p]),t.push([o,o,h,r,p]);return t},Shapes.prototype.rectang=function(o,r,p,t){void 0===p&&(p="."),void 0===t&&(t="#000");for(var h=[],n=0;o>n;n++)h.push([n,0,0,p,t]),h.push([n,r,0,p,t]);for(var u=0;r+1>u;u++)h.push([0,u,0,p,t]),h.push([o,u,0,p,t]);return h},Shapes.prototype.sphere=function(o,r,p){void 0===r&&(r="."),void 0===p&&(p="#000")},Shapes.prototype.scatterCube=function(o,r,p,t){void 0===p&&(p=["."]),p instanceof Array||(p=[p]),void 0===t&&(t="#000"),t instanceof Array||(t=[t]);for(var h=[],n=0;o*o*r>n;n++)h.push([Math.random()*o,Math.random()*o,Math.random()*o,p[Math.floor(Math.random()*p.length)],t[Math.floor(Math.random()*t.length)]]);return h},Shapes.prototype.grid=function(o,r,p,t){"undefined"==typeof p&&(p="."),"undefined"==typeof t&&(t="#000");for(var h=[],n=1;o>n;n+=1)for(var u=0;r>u;u+=1)h.push([n,u,1,p,t]);return h};
function Canvas(t){this.elem=t,this.ctx=this.elem.getContext("2d"),this.width=t.width,this.height=t.height}function Keyboard(t){var e={keys:{},keyPress:function(t){this.keys[t.keyCode]>0||(this.keys[t.keyCode]=t.timeStamp||(new Date).getTime())},keyRelease:function(t){this.keys[t.keyCode]=0}};return t.addEventListener("keydown",e.keyPress.bind(e)),t.addEventListener("keyup",e.keyRelease.bind(e)),e}function Scroll(t){var e={deltaX:0,deltaY:0};return t.onscroll=function(s){s.preventDefault(),e.deltaX=t.pageXOffset,e.deltaY=t.pageYOffset},e}Envi.prototype.keyCheck=function(){this.keyboard.keys[39]>0&&(this.shiftX+=.025),this.keyboard.keys[37]>0&&(this.shiftX-=.025),this.keyboard.keys[38]>0&&(this.shiftY-=.025),this.keyboard.keys[40]>0&&(this.shiftY+=.025)},Envi.prototype.mouseCheck=function(){return this.mouse?this.mouseLastPos?void((this.mouse.x!=this.mouseLastPos.x||this.mouse.y!=this.mouseLastPos.y)&&(this.mouse.x>this.mouseLastPos.x?this.shiftX+=.001*(this.mouse.x-this.mouseLastPos.x):this.mouse.x<this.mouseLastPos.x&&(this.shiftX-=.001*(this.mouseLastPos.x-this.mouse.x)),this.mouse.y>this.mouseLastPos.y?this.shiftY+=.001*(this.mouse.y-this.mouseLastPos.y):this.mouse.y<this.mouseLastPos.y&&(this.shiftY-=.001*(this.mouseLastPos.y-this.mouse.y)),this.mouseLastPos={x:this.mouse.x,y:this.mouse.y})):void(this.mouseLastPos={x:window.outerWidth/2,y:window.outerHeight/2}):void 0},Envi.prototype.scrollCheck=function(){0!=this.scroll.deltaY&&(this.shiftY+=.004*this.scroll.deltaY),0!=this.scroll.deltaX&&(this.shiftX+=.004*this.scroll.deltaX)};var utils={};utils.captureMouse=function(t){var e={x:0,y:0};return t.addEventListener("mousemove",function(s){var i,o;s.pageX||s.pageY?(i=s.pageX,o=s.pageY):(i=s.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=s.clientY+document.body.scrollTop+document.documentElement.scrollTop),i-=t.offsetLeft,o-=t.offsetTop,e.x=i,e.y=o},!1),e},utils.captureTouch=function(t){var e={x:null,y:null,ispressed:!1};return t.addEventListener("touchstart",function(t){e.ispressed=!0},!1),t.addEventListener("touchend",function(t){var s,i,o=t.touches[0];o.pageX||o.pageY?(s=o.pageX,i=o.pageY):(s=o.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=o.clientY+document.body.scrollTop+document.documentElement.scrollTop),s-=offsetLeft,i-=offsetTop,e.x=s,e.y=i},!1),e},utils.getAnimationFrame=function(){window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)})},utils.setCanvas=function(t){function e(e){function s(e){t.innerWidth>t.innerHeight?(e.width=Math.min(600,t.innerHeight-60),e.height=Math.min(600,t.innerHeight-60)):(e.width=Math.min(600,t.innerWidth-60),e.height=Math.min(600,t.innerWidth-60))}e.getAttribute("style")||"";t.addEventListener("resize",function(){s(e)},!1),s(e)}t.addEventListener("load",function(){var t=document.getElementsByTagName("canvas")[0];e(t)},!1)},utils.doKeyDown=function(t){switch(t.keyCode){case 38:y-dy>0&&(y-=dy);break;case 40:y+dy<HEIGHT&&(y+=dy);break;case 37:x-dx>0&&(x-=dx);break;case 39:x+dx<WIDTH&&(x+=dx)}};